# ike tunnel mode (esp) (includes a nat-t tunnel mode initiator side)
remote ike_tun_remote {
	acceptable_kmp { ikev2; };

	ikev2 {
		my_id ipaddr "${MY_GWADDRESS}";
		peers_id ipaddr "${PEERS_GWADDRESS}";
		peers_ipaddr "${PEERS_GWADDRESS}" port 500;
		kmp_enc_alg { aes128_cbc; };
		kmp_hash_alg { hmac_sha1;hmac_md5; };
		kmp_prf_alg  { hmac_sha1;hmac_md5; };
		kmp_dh_group { 2;1; };
		## Use Certificate
		kmp_auth_method { rsasig; };
		my_public_key x509pem "${CERTDIR}/${MY_PUB_KEY}" "${CERTDIR}/${MY_PRI_KEY}";
		peers_public_key x509pem "${CERTDIR}/${PEERS_PUB_KEY}" "";		
		
	};
	selector_index ike_tun_sel_in;
};

selector ike_tun_sel_out {
	direction outbound;
	src "${MY_NET}";
	dst "${PEERS_NET}";
	policy_index ike_tun_policy;
};

selector ike_tun_sel_in {
	direction inbound;
	dst "${MY_NET}";
	src "${PEERS_NET}";
	policy_index ike_tun_policy;
};

policy ike_tun_policy {
	action auto_ipsec;
	remote_index ike_tun_remote;
	ipsec_mode tunnel;
	ipsec_index { ipsec_esp; };
	ipsec_level require;
	peers_sa_ipaddr "${PEERS_GWADDRESS}";
	my_sa_ipaddr "${MY_GWADDRESS}";
};

